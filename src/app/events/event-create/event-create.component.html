<div *ngIf="isVisible" class="full pop-up-wrap">
  <div [style.opacity]="isOpened ? 1 : 0" class="full overlay"></div>
  <div class="a-c pop-up" [ngClass]="getPopUpClass()">

    <div class="p-inner full">

      <div class="p-header flex-center flex-between">
        <h3 class="h">Новая запись</h3>
        <svg class="p-cross" icon="cross" (click)="close()"></svg>
      </div>

      <div class="pop-body">
        <ng-container [ngTemplateOutlet]="step == 0 ? doctorTemplate : step == 1 ? ticketTemplate : clientTemplate"></ng-container>
      </div>

      <div class="p-footer flex-center flex-between">
        <button *ngIf="step > 0" class="btn-cancel" (click)="back()">Назад</button>
        <button *ngIf="step < 2" class="action-btn" [ngClass]="{loading: isLoadingStep, disabled: isDisabled()}" (click)="next()">Далее</button>
        <button *ngIf="step == 2" class="action-btn" [ngClass]="{loading: isLoadingSave, disabled: isDisabled()}" (click)="save()">Записаться</button>
      </div>

    </div>

  </div>
</div>


<ng-template #doctorTemplate>
  <div class="step">
    <h4 class="h">Выберите врача</h4>

    <div>
      <search-input
        type="text"
        label="Специализация"
        [required]='false'
        (onSelect)="handleRoleSelect($event)"
        [dataList]="allRoles"
        [(value)]="doctorRole"
        [canType]="false"
      ></search-input>
      <search-input
        [type]="'text'"
        [label]="'Врач'"
        [dataList]="doctors"
        [withPhotos]="true"
        [(value)]="doctorName"
        (onSelect)="handleDoctorSelect($event)"
        [canType]="false"
      ></search-input>
    </div>
  </div>
</ng-template>


<ng-template #ticketTemplate>
  <div class="w-full date-wrapper" [style]="getDateStyle()">
    <div>
      <div class="card-h text-center" [style.opacity]="!!doctor ? 1 : 0">Выберите день</div>
      <select-date class="w-full" *ngIf="isOpened"
                   [data]="days"
                   [canSelect]="!!doctor"
                   [loading]="loadingDays"
                   (onSelect)="handleDaySelect($event)"
      ></select-date>
    </div>
    <div>
      <div *ngIf="!!day" class="flex flex-col h-full">
        <div class="card-h flex items-center justify-center flex-shrink-0">
          <div class="cursor-pointer mr-4" tooltip="Выбрать другой день" [zIndex]="10" (click)="clearDate()">
            <svg icon="back" class="h-4 w-4"></svg>
          </div>
          <div [innerText]="day.display"></div>
        </div>

        <div class="time-options h-full" id="time-options">
          <div class="time" *ngFor="let t of day.intervals; index as i"
               (click)="selectTime(i)" [ngClass]="i === selectedInterval ? 's-i' : ''">
            {{getIntervalString(t)}}
          </div>
        </div>

      </div>
    </div>
  </div>
</ng-template>


<ng-template #clientTemplate>
  <div class="w-[50%] pr-4">
    <div class="m-card">
      <div class="card-h">Клиент</div>
      <ng-input
        type="phone"
        label="Телефон"
        next="ФИО"
        [(value)]="client.primaryPhone"
      ></ng-input>
      <search-input
        type="text"
        label="ФИО"
        [(value)]="client.name"
      ></search-input>
    </div>
  </div>

</ng-template>
